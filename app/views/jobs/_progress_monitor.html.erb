<div class="progress-monitor" data-job-id="<%= job.id %>">
  <h4>마이그레이션 진행 상황</h4>
  
  <!-- 전체 진행률 -->
  <div class="overall-progress mb-4">
    <div class="d-flex justify-content-between mb-2">
      <span>전체 진행률</span>
      <strong class="progress-percentage text-primary"><%= job.progress %>%</strong>
    </div>
    <div class="progress" style="height: 30px;">
      <div class="progress-bar progress-bar-striped progress-bar-animated migration-progress-bar" 
           role="progressbar" 
           style="width: <%= job.progress %>%"
           aria-valuenow="<%= job.progress %>" 
           aria-valuemin="0" 
           aria-valuemax="100">
        <%= job.progress %>%
      </div>
    </div>
  </div>
  
  <!-- 상세 정보 (단순화) -->
  <div class="card">
    <div class="card-body">
      <h5 class="card-title">진행 상태</h5>
      
      <div class="row">
        <div class="col-md-6">
          <dl class="row">
            <dt class="col-sm-6">처리 중인 리비전:</dt>
            <dd class="col-sm-6" id="current-revision">
              <strong><%= job.current_revision || 0 %> / <%= job.total_revisions || '?' %></strong>
            </dd>
            
            <dt class="col-sm-6">경과 시간:</dt>
            <dd class="col-sm-6" id="elapsed-time">
              <%= job.formatted_duration %>
            </dd>
          </dl>
        </div>
        
        <div class="col-md-6">
          <dl class="row">
            <dt class="col-sm-6">예상 완료 시간:</dt>
            <dd class="col-sm-6" id="eta">
              <strong><%= job.formatted_eta || '계산 중...' %></strong>
            </dd>
            
            <dt class="col-sm-6">처리 속도:</dt>
            <dd class="col-sm-6" id="processing-speed">
              <%= job.processing_speed ? "#{job.processing_speed.round(1)} 리비전/초" : "-" %>
            </dd>
          </dl>
        </div>
      </div>
      
      <!-- 현재 처리 중 항목 -->
      <div class="mt-3 p-2 bg-light rounded">
        <small class="text-muted">현재 처리 중:</small>
        <div class="current-commit font-monospace small" id="current-commit">
          <%= job.current_commit_message || "-" %>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 단계별 진행 상황 (간소화) -->
  <div class="stage-progress mt-4">
    <h5>단계별 진행 상황</h5>
    <div class="list-group">
      <% stages = [
        { name: "1. SVN 저장소 검증", threshold: 0 },
        { name: "2. Git 저장소 초기화", threshold: 10 },
        { name: "3. SVN 커밋 이력 변환", threshold: 20, end_threshold: 70 },
        { name: "4. 마이그레이션 전략 적용", threshold: 71, end_threshold: 79 },
        { name: "5. GitLab으로 푸시", threshold: 80, end_threshold: 99 }
      ] %>
      
      <% stages.each do |stage| %>
        <% 
          is_complete = job.progress > (stage[:end_threshold] || stage[:threshold])
          is_active = !is_complete && job.progress >= stage[:threshold]
          status_class = is_complete ? 'list-group-item-success' : (is_active ? 'list-group-item-info' : '')
          status_text = is_complete ? '완료' : (is_active ? '진행 중' : '대기')
        %>
        
        <div class="list-group-item <%= status_class %>">
          <div class="d-flex w-100 justify-content-between">
            <h6 class="mb-1"><%= stage[:name] %></h6>
            <small><strong><%= status_text %></strong></small>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script type="module">
  document.addEventListener('DOMContentLoaded', function() {
    const jobId = <%= job.id %>;
    
    // 진행 중인 job만 ActionCable 구독
    <% if job.running? %>
      import('/assets/channels/job_progress_channel.js').then(module => {
        if (module.subscribeToJobProgress) {
          const subscription = module.subscribeToJobProgress(jobId);
        }
      });
    <% end %>
  });
</script>