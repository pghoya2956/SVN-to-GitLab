<div class="card card-job mb-3">
  <div class="card-header status-<%= job.status %> d-flex justify-content-between align-items-center">
    <div class="d-flex align-items-center">
      <% job_icon = case job.job_type
         when 'migration' then 'bi-arrow-left-right'
         when 'incremental_sync' then 'bi-arrow-repeat'
         else 'bi-gear'
         end %>
      <i class="bi <%= job_icon %> me-2 fs-5"></i>
      <div>
        <strong><%= job.job_type.humanize %></strong>
        <% status_icon = case job.status
           when 'completed' then 'bi-check-circle-fill'
           when 'failed' then 'bi-x-circle-fill'
           when 'running' then 'bi-arrow-repeat'
           when 'cancelled' then 'bi-dash-circle-fill'
           else 'bi-hourglass-split'
           end %>
        <span class="status-badge status-<%= job.status %> ms-2">
          <i class="bi <%= status_icon %>"></i>
          <%= job.status.capitalize %>
        </span>
      </div>
    </div>
    <div class="d-flex gap-2">
      <%= link_to job_path(job), class: "btn btn-sm btn-outline-primary" do %>
        <i class="bi bi-eye"></i> Details
      <% end %>
      <% if job.active? %>
        <%= button_to cancel_job_path(job), method: :post, 
                      class: "btn btn-sm btn-outline-danger",
                      data: { confirm: "Are you sure you want to cancel this job?" } do %>
          <i class="bi bi-stop-circle"></i> Cancel
        <% end %>
      <% end %>
    </div>
  </div>
  
  <div class="card-body">
    <div class="row">
      <div class="col-md-6">
        <div class="d-flex align-items-start mb-2">
          <i class="bi bi-folder text-muted me-2"></i>
          <div>
            <small class="text-muted d-block">Repository</small>
            <%= link_to job.repository.name, repository_path(job.repository), class: "fw-semibold text-decoration-none" %>
          </div>
        </div>
        <div class="d-flex align-items-start mb-2">
          <i class="bi bi-clock text-muted me-2"></i>
          <div>
            <small class="text-muted d-block">Started</small>
            <span class="fw-medium"><%= job.started_at&.strftime('%Y-%m-%d %H:%M:%S') || 'Not started' %></span>
          </div>
        </div>
        <div class="d-flex align-items-start">
          <i class="bi bi-stopwatch text-muted me-2"></i>
          <div>
            <small class="text-muted d-block">Duration</small>
            <span class="fw-medium"><%= job.formatted_duration %></span>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <% if job.description.present? %>
          <div class="d-flex align-items-start mb-2">
            <i class="bi bi-card-text text-muted me-2"></i>
            <div>
              <small class="text-muted d-block">Description</small>
              <span class="fw-medium"><%= job.description %></span>
            </div>
          </div>
        <% end %>
        <% if job.completed? && job.result_url.present? %>
          <div class="d-flex align-items-start">
            <i class="bi bi-gitlab text-muted me-2"></i>
            <div>
              <small class="text-muted d-block">Result</small>
              <%= link_to job.result_url, target: "_blank", class: "fw-medium text-decoration-none" do %>
                View in GitLab <i class="bi bi-box-arrow-up-right small"></i>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
    
    <% if job.active? || job.progress > 0 %>
      <div class="mt-3">
        <div class="d-flex justify-content-between align-items-center mb-1">
          <small class="text-muted">Progress</small>
          <small class="fw-medium"><%= job.progress_percentage %>%</small>
        </div>
        <div class="progress" style="height: 25px;">
          <div class="progress-bar progress-bar-striped <%= job.running? ? 'progress-bar-animated' : '' %> <%= job.failed? ? 'bg-danger' : '' %>" 
               role="progressbar" 
               style="width: <%= job.progress_percentage %>%"
               aria-valuenow="<%= job.progress_percentage %>" 
               aria-valuemin="0" 
               aria-valuemax="100">
            <%= job.progress_percentage %>%
          </div>
        </div>
        
        <% if job.processed_commits && job.processed_commits > 0 %>
          <div class="d-flex justify-content-between mt-2">
            <small class="text-muted">
              <i class="bi bi-git me-1"></i>
              Commits: <%= job.processed_commits %>
              <% if job.total_commits && job.total_commits > 0 %>
                / <%= job.total_commits %>
              <% end %>
            </small>
            <% if job.processing_speed && job.processing_speed > 0 %>
              <small class="text-muted">
                <i class="bi bi-speedometer me-1"></i>
                <%= job.processing_speed.round(1) %> commits/sec
              </small>
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>
    
    <% if job.failed? && job.error_log.present? %>
      <div class="alert alert-danger d-flex align-items-start mt-3 mb-0">
        <i class="bi bi-exclamation-triangle-fill me-2 flex-shrink-0"></i>
        <div class="flex-grow-1">
          <strong class="d-block mb-1">Error Details:</strong>
          <pre class="mb-0 bg-white p-2 rounded border" style="max-height: 120px; overflow-y: auto; font-size: 0.875rem;"><%= job.error_log.lines.last(5).join %></pre>
        </div>
      </div>
    <% end %>
  </div>
</div>