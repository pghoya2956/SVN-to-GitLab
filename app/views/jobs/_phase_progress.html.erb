<div class="phase-progress mb-4">
  <div class="card">
    <div class="card-header">
      <h6 class="mb-0">
        <i class="bi bi-diagram-3"></i> 마이그레이션 단계
      </h6>
    </div>
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center">
        <% Job::PHASES.each do |phase_key, phase_name| %>
          <% next if phase_key == :pending %>
          <div class="phase-item <%= phase_status_class(job, phase_key) %>">
            <div class="phase-icon">
              <% if phase_completed?(job, phase_key) %>
                <i class="bi bi-check-circle-fill"></i>
              <% elsif phase_current?(job, phase_key) %>
                <i class="bi bi-arrow-right-circle-fill"></i>
              <% else %>
                <i class="bi bi-circle"></i>
              <% end %>
            </div>
            <div class="phase-name">
              <%= phase_name %>
            </div>
            <% if phase_current?(job, phase_key) && job.phase_details.present? %>
              <div class="phase-detail">
                <small><%= job.phase_details['progress_percentage'] %>%</small>
              </div>
            <% end %>
          </div>
          <% unless phase_key == :completed %>
            <div class="phase-connector <%= 'completed' if phase_completed?(job, phase_key) %>"></div>
          <% end %>
        <% end %>
      </div>
      
      <% if job.checkpoint_data.present? && job.failed? %>
        <div class="mt-3 p-2 bg-light rounded">
          <small class="text-muted">
            <i class="bi bi-save"></i> 마지막 체크포인트: 
            <%= job.checkpoint_data['timestamp'].to_datetime.strftime('%Y-%m-%d %H:%M:%S') rescue 'N/A' %>
            <% if job.checkpoint_data['last_revision'] %>
              (리비전 <%= job.checkpoint_data['last_revision'] %>)
            <% end %>
          </small>
        </div>
      <% end %>
    </div>
  </div>
</div>

<style>
  .phase-progress {
    margin-bottom: 1rem;
  }
  
  .phase-item {
    text-align: center;
    flex: 1;
    position: relative;
  }
  
  .phase-icon {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
  }
  
  .phase-icon i {
    color: #6c757d;
  }
  
  .phase-item.completed .phase-icon i {
    color: #28a745;
  }
  
  .phase-item.current .phase-icon i {
    color: #007bff;
    animation: pulse 1.5s infinite;
  }
  
  .phase-name {
    font-size: 0.875rem;
    font-weight: 500;
  }
  
  .phase-detail {
    font-size: 0.75rem;
    color: #6c757d;
  }
  
  .phase-connector {
    flex: 0 0 50px;
    height: 2px;
    background: #e9ecef;
    align-self: center;
    margin: 0 -25px;
    margin-bottom: 2rem;
  }
  
  .phase-connector.completed {
    background: #28a745;
  }
  
  @keyframes pulse {
    0% {
      opacity: 1;
    }
    50% {
      opacity: 0.5;
    }
    100% {
      opacity: 1;
    }
  }
</style>

