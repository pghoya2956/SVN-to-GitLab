<!DOCTYPE html>
<html>
  <head>
    <title>SVN to GitLab Migration</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
      <div class="container">
        <%= link_to root_path, class: "navbar-brand d-flex align-items-center" do %>
          <i class="bi bi-arrow-left-right me-2"></i>
          <span>SVN to GitLab Migration</span>
        <% end %>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto">
            <li class="nav-item">
              <%= link_to repositories_path, class: "nav-link #{controller_name == 'repositories' ? 'active' : ''}" do %>
                <i class="bi bi-folder-fill me-1"></i> Repositories
              <% end %>
            </li>
            <li class="nav-item">
              <%= link_to jobs_path, class: "nav-link #{controller_name == 'jobs' ? 'active' : ''}" do %>
                <i class="bi bi-list-task me-1"></i> Jobs
              <% end %>
            </li>
          </ul>
          <div class="navbar-nav">
            <% if gitlab_authenticated? %>
              <div class="dropdown">
                <a class="nav-link dropdown-toggle text-light" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="bi bi-person-circle me-1"></i> 
                  <%= current_gitlab_user&.dig(:username) %>
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li>
                    <%= button_to logout_path, method: :delete, class: "dropdown-item" do %>
                      <i class="bi bi-box-arrow-right me-2"></i>Logout
                    <% end %>
                  </li>
                </ul>
              </div>
            <% else %>
              <div class="dropdown">
                <a class="nav-link text-light" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="bi bi-person-circle me-1"></i>
                  Guest
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li>
                    <%= link_to login_path, class: "dropdown-item" do %>
                      <i class="bi bi-box-arrow-in-right me-2"></i>Login
                    <% end %>
                  </li>
                </ul>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </nav>
    
    <!-- Toast Container - 오른쪽 하단 -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 11">
      <% if notice.present? %>
        <div id="noticeToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
          <div class="d-flex">
            <div class="toast-body">
              <i class="bi bi-check-circle-fill me-2"></i>
              <%= notice %>
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
        </div>
      <% end %>
      
      <% if alert.present? %>
        <div id="alertToast" class="toast align-items-center text-bg-danger border-0" role="alert" aria-live="assertive" aria-atomic="true">
          <div class="d-flex">
            <div class="toast-body">
              <i class="bi bi-exclamation-triangle-fill me-2"></i>
              <%= alert %>
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
        </div>
      <% end %>
    </div>
    
    <main class="container my-4">
      <%= yield %>
    </main>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
      // Toast 자동 표시 함수
      function showToasts() {
        // Notice Toast
        const noticeToastEl = document.getElementById('noticeToast');
        if (noticeToastEl && !noticeToastEl.classList.contains('show')) {
          const noticeToast = new bootstrap.Toast(noticeToastEl, {
            animation: true,
            autohide: true,
            delay: 5000 // 5초 후 자동 숨김
          });
          noticeToast.show();
        }
        
        // Alert Toast
        const alertToastEl = document.getElementById('alertToast');
        if (alertToastEl && !alertToastEl.classList.contains('show')) {
          const alertToast = new bootstrap.Toast(alertToastEl, {
            animation: true,
            autohide: true,
            delay: 5000 // 5초 후 자동 숨김
          });
          alertToast.show();
        }
      }
      
      // 페이지 로드 시 실행
      document.addEventListener('DOMContentLoaded', showToasts);
      
      // Turbo로 페이지 전환 시 실행
      document.addEventListener('turbo:load', showToasts);
      
      // Turbo frame 로드 시 실행
      document.addEventListener('turbo:frame-load', showToasts);
      
      // 페이지가 이미 로드된 경우 즉시 실행
      if (document.readyState === 'complete' || document.readyState === 'interactive') {
        setTimeout(showToasts, 100);
      }
    </script>
  </body>
</html>